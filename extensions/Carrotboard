import discord
from discord.ext import commands
from discord import Embed
from datetime import datetime


class carrotboard(commands.Cog):
    def __init__(self, bot):
        self.bot = bot

    @commands.Cog.listener()
    async def on_raw_reaction_add(self, payload):
        payload.emoji.name == ":carrot:"
        message = await self.bot.get_channel(payload.channel_id).fetch_message(payload.message_id)
        

        if not message.author.bot and payload.member.id != message.autho.id:
            msg_id, carrots = 0 #dont know how to get how many carrots, --> from database
            embed = Embed(title = "Carroted Message",
                            colour = message.autho.colour,
                            timestamp = datetime.utcnow())
            
            fields = (("Author", message.author.mention, False),
                        ("Content", message.content, False),
                        ("Carrots", carrots + 1, False))

            for name, value, inline in fields:
                Embed.add_field(name=name, value=value, inline = inline)

            if carrots:
                carrot_message = await self.starboard_channel.send (embed = embed)
                #insert database of how many carrots?

            else:
                carrot_message = await self.carrotboard_channel.fetch_message(msg_id)
                await carrot_message.edit(embed = embed)

        else:
            await message.remove_reaction(payload.emoji, payload.member)

def setup(bot):
    bot.add_cog(carrotboard(bot))